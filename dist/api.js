((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?module.exports=t():'function'==typeof define&&define.amd?define(t):((e='undefined'!=typeof globalThis?globalThis:e||self).Vidbeo=e.Vidbeo||{},e.Vidbeo.Player=t())})(this,(function(){function e(t){return e='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?e=>typeof e:e=>e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e,e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:'undefined'!=typeof Symbol&&e[Symbol.iterator]||e['@@iterator'];if(null==n)return;var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}(e,t)||function(e,t){if(!e)return;if('string'==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);'Object'===n&&e.constructor&&(n=e.constructor.name);if('Map'===n||'Set'===n)return Array.from(e);if('Arguments'===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError('Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.')}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{},a={exports:{}};!function(e){var t,n;t=i,n=function(){var e=()=>{},t='undefined',n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=['trace','debug','info','warn','error'];function o(e,t){var n=e[t];if('function'==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply||Function.prototype.apply.apply(console.log,[console,arguments])),console.trace}function a(r){return'debug'===r&&(r='log'),typeof console!==t&&('trace'===r&&n?i:void 0!==console[r]?o(console,r):void 0!==console.log?o(console,'log'):e)}function l(t,n){for(var o=0;o<r.length;o++){var i=r[o];this[i]=o<t?e:this.methodFactory(i,t,n)}this.log=this.debug}function s(e,n,r){return function(){typeof console!==t&&(l.call(this,n,r),this[e].apply(this,arguments))}}function u(e,t,n){return a(e)||s.apply(this,arguments)}function d(e,n,o){var i,a=this,s='loglevel';function d(){var e;if(typeof window!==t&&s){try{e=window.localStorage[s]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(s)+'=');-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}'string'==typeof e?s+=':'+e:'symbol'==typeof e&&(s=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=o||u,a.getLevel=()=>i,a.setLevel=(n,o)=>{if('string'==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!('number'==typeof n&&n>=0&&n<=a.levels.SILENT))throw'log.setLevel() called with invalid level: '+n;if(i=n,!1!==o&&(e=>{var n=(r[e]||'silent').toUpperCase();if(typeof window!==t&&s){try{return void(window.localStorage[s]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(s)+'='+n+';'}catch(e){}}})(n),l.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return'No console available for logging'},a.setDefaultLevel=e=>{d()||a.setLevel(e,!1)},a.enableAll=e=>{a.setLevel(a.levels.TRACE,e)},a.disableAll=e=>{a.setLevel(a.levels.SILENT,e)};var f=d();null==f&&(f=n??'WARN'),a.setLevel(f,!1)}var f=new d,c={};f.getLogger=e=>{if('symbol'!=typeof e&&'string'!=typeof e||''===e)throw new TypeError('You must supply a name when creating a logger.');var t=c[e];return t||(t=c[e]=new d(e,f.getLevel(),f.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return f.noConflict=()=>(typeof window!==t&&window.log===f&&(window.log=h),f),f.getLoggers=()=>c,f.default=f,f},e.exports?e.exports=n():t.log=n()}(a);var l=a.exports,s='undefined'!=typeof window&&void 0!==window.document,u='undefined'!=typeof process&&null!=process.versions&&null!=process.versions.node||null!=typeof caches.default,d='undefined'!=typeof window&&void 0!==window.postMessage,f=new WeakMap;function c(e,t){var n=f.get(e.element)||{};return void 0===n[t]?[]:n[t]}function h(e,t,n){var r=f.get(e.element)||{};if(!r[t]||0===r[t].length)return!0;if(!n)return r[t]=[],f.set(e.element,r),!0;var o=r[t].indexOf(n);return-1!==o&&r[t].splice(o,1),f.set(e.element,r),0===r[t].length}function y(e,t){var n=c(e,t);if(0===n.length)return!1;var r=n.shift();return h(e,t,r),r}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'';return(10===e.length||21===e.length)&&/^([a-zA-Z0-9_-]+)$/.test(e)}var g={isBrowser:s,isServer:u,supportsPostMessage:d,supportedEvents:['durationchange','ended','error','fullscreenchange','hotspotclicked','loadedmetadata','pause','play','playing','progress','qualitychange','playbackratechange','ready','seeked','seeking','trackchange','timeupdate','volumechange'],supportedMethods:['exitFullscreen','getBuffered','getColour','getCurrentTime','getDuration','getEmbed','getEnded','getFullscreen','getHeight','getId','getLoop','getMuted','getPaused','getPlaybackRate','getPlayed','getQualities','getQuality','getSeekable','getSeeking','getTracks','getTitle','getUrl','getVolume','getWidth','off','on','pause','play','ready','requestFullscreen','setColour','setCurrentTime','setLoop','setMuted','setPlaybackRate','setQuality','setVolume'],weakmapCallbacks:f,isVidbeoIframe:function(e){if(!e||null==e||!e instanceof Element)return!1;if('IFRAME'!==e.nodeName)return!1;var t=e.getAttribute('src');return!('string'!=typeof t||!t.startsWith('https'))&&!!t.startsWith('https://embed.vidbeo.com')},isVidbeoOrigin:function(e){return!(!e||null==e||''===e)&&['https://embed.vidbeo.com'].includes(e)},postMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'',n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e.element.contentWindow||!e.element.contentWindow.postMessage)throw new Error('The iframe embed could not be contacted');var r={type:'method',name:t,value:null};null!=n&&(r.value=n),e.element.contentWindow.postMessage(r,e.origin)},processMessage:function(t,n){if('string'==typeof n)try{n=JSON.parse(n)}catch(e){return!1}void 0===n.value&&(n.value=null);var r=null,o=[];if(n.value&&'object'===e(n.value)&&'string'==typeof n.value.error){c(t,n.type+':'+n.name).forEach((e=>{var r=new Error(n.value.error);r.name='Error',e.reject(r),h(t,n.type+':'+n.name,e)}))}else{if('method'===n.type){var i=y(t,'method:'+n.name);i&&(o.push(i),r=n.value)}'event'===n.type&&(o=c(t,'event:'+n.name),r=n.value),o.forEach((e=>{try{'function'==typeof e?e.call(t,r):e.resolve(r)}catch(e){}}))}},saveCallback:function(e,t,n){var r=f.get(e.element)||{};t in r||(r[t]=[]),r[t].push(n),f.set(e.element,r)},getCallbacks:c,removeCallback:h,swapCallbacks:function(e,t){var n=f.get(e);f.set(t,n),f.delete(e)},shiftCallbacks:y,extractValidEmbedParams:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=['aspectratio','autoplay','colour','controls','buttons','dnt','height','id','jwt','keyboard','loop','muted','playsinline','preload','quality','responsive','t','title','track','width'],o=0,i=Object.entries(e);o<i.length;o++){var a=r(i[o],2),l=a[0],s=a[1];n.includes(l)&&(t[l]=s)}return t},isIdValid:m,buildIframeSrc:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e||'string'!=typeof e.id||!m(e.id))return'';for(var t='https://embed.vidbeo.com/'+e.id,n=[],o=0,i=Object.entries(e);o<i.length;o++){var a=r(i[o],2),l=a[0],s=a[1];['aspectratio','height','id','responsive','width'].includes(l)||('boolean'==typeof s&&(s=s?1:0),n.push(l+'='+encodeURIComponent(s)))}return n.length>0&&(t+='?'+n.join('&')),t},htmlElement:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'',t=document.createElement('div');return t.innerHTML=e,t.firstChild}};if(g.isBrowser,l.setLevel('silent'),!g.isServer&&!g.supportsPostMessage)throw l.warn('The Player API is not supported'),new Error('The Player API is not supported');var p=new WeakMap,v=new WeakMap,w=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t(this,e),l.info('Player constructor',r),null==n||void 0===n)throw l.warn('The first parameter must be a valid id or element'),new Error('The first parameter must be a valid id or element');if('string'==typeof n&&g.isBrowser&&(l.info('Param was a string, so look for an element with id of',n),n=document.getElementById(n)),!n instanceof Element)throw l.warn('The first parameter must either be a valid id or element'),new Error('The first parameter must either be a valid id or element');if('IFRAME'===n.nodeName){if(!g.isVidbeoIframe(n))throw l.warn('The first parameter is an iframe but not a valid embedded video'),new Error('The first parameter is an iframe but not a valid embedded video')}else{var o=n.querySelector('iframe');if(null!=o)n=o;else if(null===r||'string'!=typeof r.id||!g.isIdValid(r.id))throw l.warn('The options.id is missing or invalid'),new Error('The options.id is missing or invalid')}if(p.has(n))return l.info('This element is already known to this JS, so return the Player we already have for it'),p.get(n);var i=this;this.element=n,this.origin='*',this._window=n.ownerDocument.defaultView;var a=new Promise(((e,t)=>{if(i.receivedMessage=n=>{if(g.isVidbeoOrigin(n.origin)&&i.element.contentWindow===n.source){if('*'===i.origin&&(i.origin=n.origin,l.info('The origin is now known:',i.origin)),'string'==typeof n.data){l.info('The message data is a string so will parse it',n.data);try{n.data=JSON.parse(n.data)}catch(r){return void l.warn(r)}}if('method'===n.data.type&&'ready'===n.data.name&&'string'==typeof n.data.value.error){l.warn('Got an error back from the iframe when asking if it was ready',n.data);var r=new Error('Could not setup player');return r.name='Error',void t(r)}if('event'===n.data.type&&'ready'===n.data.name&&'string'==typeof n.data.value.error){l.warn('The iframe reported an error with getting ready',n.data);var o=new Error('Could not setup player');return o.name='Error',void t(o)}if('method'===n.data.type&&'ready'===n.data.name)return l.info('All good, got success back from the iframe when asking if it was ready',n.data),void e(n.data.value);if('event'===n.data.type&&'ready'===n.data.name)return l.info('All good, the iframe has reported it is now ready',n.data),void e(n.data.value);l.info('Process this message received from the embedded player',n.data),g.processMessage(i,n.data)}else l.info('Ah, the message was not from our iframe so ignore it')},l.info('Listening for any messages sent from the embedded player'),i._window.addEventListener('message',i.receivedMessage),'IFRAME'!==i.element.nodeName){l.info('The element passed is NOT already an iframe, so need to make an iframe within that element e.g div');var o=g.extractValidEmbedParams(r),a='';a=o.width&&o.height&&!isNaN(o.width)&&!isNaN(o.height)?'fixed':'boolean'==typeof o.responsive?o.responsive?'responsive':'manual':'responsive';var s=document.createElement('iframe');s.setAttribute('src',g.buildIframeSrc(o)),'fixed'===a&&(s.setAttribute('width',o.width),s.setAttribute('height',o.height)),s.setAttribute('loading','lazy'),s.setAttribute('frameborder','0'),s.setAttribute('allowfullscreen',''),s.setAttribute('allow','accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture;'),'responsive'===a&&(n.style.position='relative',n.style.paddingBottom='56.25%',o.aspectratio&&('1:1'===o.aspectratio?n.style.paddingBottom='100%':'4:3'===o.aspectratio?n.style.paddingBottom='75%':'21:9'===o.aspectratio?n.style.paddingBottom='42.857%':'9:16'===o.aspectratio?n.style.paddingBottom='156.25%':n.style.paddingBottom='56.25%'),s.style.position='absolute',s.style.top=0,s.style.left=0,s.style.border=0,s.style.width='100%',s.style.height='100%'),n.appendChild(s),i.element=s,i._originalElement=n,g.swapCallbacks(n,s),l.info('Record the new iframe element in weakmapPlayer'),p.set(i.element,i)}}));return v.set(this,a),p.set(this.element,this),'IFRAME'===this.element.nodeName&&(l.info('Send a message to the iframe to ask if it is ready by sending it a message to ask'),g.postMessage(this,'ready',null)),document.fullscreenEnabled&&(l.info('The HTML5 fullscreen API is supported so listen for the fullscreenchange event'),this.onDocumentFullscreenchange=function(){l.info('A fullscreenchange has happened on the document, so tell the player about it so it can update its state/UI'),document.fullscreenElement instanceof Element?g.saveCallback(i,'event:fullscreenexit',(function(){return this.playerExitFullscreen()})):g.removeCallback(i,'event:fullscreenexit',(function(){return this.playerExitFullscreen()})),i.ready().then((()=>{var e=document.fullscreenElement instanceof Element;l.info('Send a message to the iframe to tell it the full-screen state has changed as its own HTML5 video event will not fire',e),g.postMessage(i,'updateFullscreen',e)}))},document.addEventListener('fullscreenchange',this.onDocumentFullscreenchange)),this}var r,o,i;return r=e,o=[{key:'playerRequestFullscreen',value:function(e){l.info('Player.playerRequestFullscreen()');var t=this;return new Promise(((n,r)=>t.ready().then((()=>{l.info('Player.playerRequestFullscreen() call element.requestFullscreen');var t=e.requestFullscreen();void 0!==t?t.then((()=>{n(!0)})).catch((e=>{l.info('Player.playerRequestFullscreen() reject the promise with this error message',e.message);var t=new Error(e.message);t.name='Error',r(t)})):n(document.fullscreenElement)})).catch(r)))}},{key:'playerExitFullscreen',value:function(){l.info('Player.playerExitFullscren()');var e=this;return new Promise(((t,n)=>e.ready().then((()=>{document.fullscreenElement instanceof Element||(l.info('Player.playerExitFullscren() the player is not fullscreen, so nothing to do'),t(!1)),l.info('Player.playerExitFullscren() call document.exitFullscreen()');var e=document.exitFullscreen();void 0!==e?e.then((()=>{t(!1)})).catch((e=>{l.info('Player.playerExitFullscreen() reject the promise with this error message',e.message);var t=new Error(e.message);t.name='Error',n(t)})):t(!document.fullscreenElement)})).catch(n)))}},{key:'method',value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'',t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(l.info('Player.method()',e,t),!e||''==e)throw new Error('A method is required');if(!g.supportedMethods.includes(e))throw new Error('That method is not supported');if(['setColour','setCurrentTime','setLoop','setMuted','setPlaybackRate','setQuality','setVolume'].includes(e)&&null===t)throw new Error('That method requires a value');var n=this;return new Promise(((r,o)=>n.ready().then((()=>{l.info('Player.method() keep a reference to the callback for this method: '+e),g.saveCallback(n,'method:'+e,{resolve:r,reject:o}),l.info('Player.method() send a message to the iframe to call this method: '+e,t),g.postMessage(n,e,t)})).catch(o)))}},{key:'exitFullscreen',value:function(){return l.info('Player.exitFullscreen()'),document.fullscreenEnabled?this.playerExitFullscreen():this.method('exitFullscreen')}},{key:'getBuffered',value:function(){return l.info('Player.getBuffered)'),this.method('getBuffered')}},{key:'getColour',value:function(){return l.info('Player.getColour()'),this.method('getColour')}},{key:'getCurrentTime',value:function(){return l.info('Player.getCurrentTime()'),this.method('getCurrentTime')}},{key:'getDuration',value:function(){return l.info('Player.getDuration()'),this.method('getDuration')}},{key:'getEmbed',value:function(){return l.info('Player.getEmbed()'),this.method('getEmbed')}},{key:'getEnded',value:function(){return l.info('Player.getEnded()'),this.method('getEnded')}},{key:'getFullscreen',value:function(){return l.info('Player.getFullscreen()'),this.method('getFullscreen')}},{key:'getHeight',value:function(){return l.info('Player.getHeight()'),this.method('getHeight')}},{key:'getId',value:function(){return l.info('Player.getId()'),this.method('getId')}},{key:'getLoop',value:function(){return l.info('Player.getLoop()'),this.method('getLoop')}},{key:'getMuted',value:function(){return l.info('Player.getMuted()'),this.method('getMuted')}},{key:'getPaused',value:function(){return l.info('Player.getPaused()'),this.method('getPaused')}},{key:'getPlaybackRate',value:function(){return l.info('Player.getPlaybackRate()'),this.method('getPlaybackRate')}},{key:'getPlayed',value:function(){return l.info('Player.getPlayed()'),this.method('getPlayed')}},{key:'getQualities',value:function(){return l.info('Player.getQualities()'),this.method('getQualities')}},{key:'getQuality',value:function(){return l.info('Player.getQuality()'),this.method('getQuality')}},{key:'getSeekable',value:function(){return l.info('Player.getSeekable()'),this.method('getSeekable')}},{key:'getSeeking',value:function(){return l.info('Player.getSeeking()'),this.method('getSeeking')}},{key:'getTracks',value:function(){return l.info('Player.getTracks()'),this.method('getTracks')}},{key:'getTitle',value:function(){return l.info('Player.getTitle()'),this.method('getTitle')}},{key:'getUrl',value:function(){return l.info('Player.getUrl()'),this.method('getUrl')}},{key:'getVolume',value:function(){return l.info('Player.getVolume()'),this.method('getVolume')}},{key:'getWidth',value:function(){return l.info('Player.getWidth()'),this.method('getWidth')}},{key:'off',value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'',t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(l.info('Player.off()',e),!e||''==e)throw new Error('An event is required');if(!g.supportedEvents.includes(e))throw new Error('That event is currently not supported');if(t&&'function'!=typeof t)throw new Error('A callback must be a function');var n=g.removeCallback(this,'event:'+e,t);n&&(l.info('Player.off() tell the player iframe to no longer report this event',e),this.method('off',e).catch((()=>{})))}},{key:'on',value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'',t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(l.info('Player.on()',e),!e||''==e)throw new Error('An event is required');if(!g.supportedEvents.includes(e))throw new Error('That event is currently not supported');if(!t||null==t||'function'!=typeof t)throw new Error('A callback is required and it must be a function');var n=g.getCallbacks(this,'event:'+e);0===n.length&&(l.info('Player.on() tell the embedded player the page is interested in being notified about this event',e),this.method('on',e).catch((()=>{}))),l.info('Player.on() record the callback function for',e),g.saveCallback(this,'event:'+e,t)}},{key:'pause',value:function(){return l.info('Player.pause()'),this.method('pause')}},{key:'play',value:function(){return l.info('Player.play()'),this.method('play')}},{key:'ready',value:function(){l.info('Player.ready()');var e=v.get(this)||new Promise(((e,t)=>{l.info('Player.ready(): the player has not reported itself as being ready'),t(new Error('Player is not configured'))}));return Promise.resolve(e)}},{key:'requestFullscreen',value:function(){return l.info('Player.requestFullscreen()'),document.fullscreenEnabled?this.playerRequestFullscreen(this.element):this.method('requestFullscreen')}},{key:'setColour',value:function(e){return l.info('Player.setColour()',e),this.method('setColour',e)}},{key:'setCurrentTime',value:function(e){return l.info('Player.setCurrentTime()',e),this.method('setCurrentTime',e)}},{key:'setLoop',value:function(e){return l.info('Player.setLoop()',e),this.method('setLoop',e)}},{key:'setMuted',value:function(e){return l.info('Player.setMuted()',e),this.method('setMuted',e)}},{key:'setPlaybackRate',value:function(e){return l.info('Player.setPlaybackRate()',e),this.method('setPlaybackRate',e)}},{key:'setQuality',value:function(e){return l.info('Player.setQuality()',e),this.method('setQuality',e)}},{key:'setVolume',value:function(e){return l.info('Player.setVolume()',e),this.method('setVolume',e)}}],o&&n(r.prototype,o),i&&n(r,i),e}();return w}));
